"use strict";

var _steps = require("cypress-cucumber-preprocessor/steps");

const CLOSE_TO_DELTA = 1;
(0, _steps.Given)('there is enough space to the right of the MenuItem to fit the SubMenu', () => {
  cy.visitStory('FlyoutMenu', 'Default Position');
});
(0, _steps.Given)('there is not enough space to the right of the MenuItem to fit the SubMenu', () => {
  cy.visitStory('FlyoutMenu', 'Flipped Position');
});
(0, _steps.Given)('there is not enough space to the right or the left of the MenuItem to fit the SubMenu', () => {
  cy.visitStory('FlyoutMenu', 'Shift Into View');
});
(0, _steps.When)('the user clicks on the MenuItem', () => {
  cy.get('[data-test="dhis2-uicore-menuitem"]').click();
});
(0, _steps.Then)('the right of the MenuItem is aligned with the left of the SubMenu', () => {
  getMenuItemAndSubMenuRects().should(([menuItemRect, subMenuRect]) => {
    expect(menuItemRect.right).to.closeTo(subMenuRect.left, CLOSE_TO_DELTA);
  });
});
(0, _steps.Then)('the left of the MenuItem is aligned with the right of the SubMenu', () => {
  getMenuItemAndSubMenuRects().should(([menuItemRect, subMenuRect]) => {
    expect(menuItemRect.left).to.closeTo(subMenuRect.right, CLOSE_TO_DELTA);
  });
});
(0, _steps.Then)('the SubMenu is rendered on top of the MenuItem', () => {
  getMenuItemAndSubMenuRects().should(([menuItemRect, subMenuRect]) => {
    expect(menuItemRect.left).to.be.closeTo(subMenuRect.left, CLOSE_TO_DELTA);
    expect(subMenuRect.right).to.be.closeTo(menuItemRect.right, CLOSE_TO_DELTA);
  });
});
(0, _steps.Then)('the top of the MenuItem is aligned with the top of the SubMenu wrapper', () => {
  cy.getPositionsBySelectors('[data-test="dhis2-uicore-menuitem"]', '[data-test="dhis2-uicore-popper"]').should(([menuItemRect, popperRect]) => {
    expect(menuItemRect.top).to.closeTo(popperRect.top, CLOSE_TO_DELTA);
  });
});

function getMenuItemAndSubMenuRects() {
  return cy.getPositionsBySelectors('[data-test="dhis2-uicore-menuitem"]', '[data-test="dhis2-uicore-popper"]');
}