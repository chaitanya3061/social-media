import { useCallback } from 'react';
import { useDataEngine } from './useDataEngine';
import { useQueryExecutor } from './useQueryExecutor';
import { useStaticInput } from './useStaticInput';
const empty = {};
export const useDataQuery = (query, {
  onComplete,
  onError,
  variables = empty,
  lazy = false
} = {}) => {
  const engine = useDataEngine();
  const [theQuery] = useStaticInput(query, {
    warn: true,
    name: 'query'
  });
  const execute = useCallback(options => engine.query(theQuery, options), [engine, theQuery]);
  const {
    refetch,
    called,
    loading,
    error,
    data
  } = useQueryExecutor({
    execute,
    variables,
    singular: true,
    immediate: !lazy,
    onComplete,
    onError
  });
  return {
    engine,
    refetch,
    called,
    loading,
    error,
    data
  };
};